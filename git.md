# git

## 基础知识

### 版本控制软件

版本控制软件是一个用来记录文件变化，以便将来查阅特定版本修订情况的系统，因此有时也叫“版本控制系统”

通俗理解为把手工管理文件版本的方式，改为由软件管理文件的版本，这个负责管理文件版本的软件，叫做“版本控制软件”

#### 版本控制软件的好处

1. 操作简单

只需识记几组简单的终端指令，即可快速上手常见的版本控制软件

2. 易于对比

基于版本控制软件提供的功能，能够比较方便地比较文件的变化细节，从而查找出导致问题的原因

3. 易于回溯

可以将选定的文件回溯到之前的状态，甚至将整个项目都回退到过去某个时间点的状态

4. 不易丢失

在版本控制软件中，被用户误删除的文件，可以轻松的恢复回来

#### 版本控制系统的分类

版本控制系统分为本地版本控制系统、集中化的版本控制系统和分布式版本控制系统

1. 本地版本控制系统

只能单机运行，使维护文件版本的操作工具化

2. 集中化的版本控制系统

联网运行，支持多人协作开发，性能差，用户体验不好

3. 分布式的版本控制系统

联网运行，支持多人协作开发，性能优秀，用户体验好

##### 本地版本控制系统

- 特点

使用软件来记录文件的不同版本，提高了工作效率，降低了手动维护版本的出错率

- 缺点

1.单机运行，不支持多人协作开发

2.版本数据库故障后，所有历史更新记录会丢失

##### 集中化的版本控制系统

- 特点

基于服务器、客户端的运行模式

服务器保存文件的所有更新记录

客户端只保留最新的文件版本

- 优点

联网运行，支持多人协作开发

- 缺点

1. 不支持离线提交版本更新

2. 中心服务器崩溃后，所有人无法正常工作

3. 版本数据库故障后，所有历史更新记录都会丢失

- 典型代表

SVN

#### 分布式的版本控制系统

- 特点
  - 基于服务器、客户端的运行模式

1. 服务器保存文件的所有更新记录

2. 客户端是服务器的完整备份，并不是只保留文件的最新版本

- 优点

1. 联网运行，支持多人协作开发

2. 客户端断网后支持离线本地提交版本更新

3. 服务器故障或损坏后，可使用任何一个客户端的备份进行恢复

- 典型代表
  - Git

### git相关知识

#### 什么是Git

Git是一个开源的分布式版本控制系统，是目前世界上最先进、最流行的版本控制系统。可以快速高效地处理从很小到非常大的项目版本管理

- 特点

项目越大越复杂，协同开发者越多，越能体现出Git的高性能和高可用性

#### Git的特性

Git之所以快速和高效，主要依赖于它的如下两个特性：

1. 直接记录快照，而非差异比较

2. 近乎所有操作都是本地执行

#### git与传统版本控制系统的差异比较

##### 传统的版本控制系统

传统的版本控制系统（例如SVN）是**基于差异**的版本控制，它们**存储的是一组基本文件和每个文件随时间逐步累积的差异**

> 即在版本1中存储的是原文件，后续版本均只存储与之前曾修改过的版本的差异

- 好处
  - 节省磁盘空间

- 缺点
  - 耗时、效率低

传统的版本控制系统在每次切换版本的时候，都需要在基本文件的基础上，应用每个差异，从而生成目标版本对应的文件

##### git

git是**基于快照**的版本控制，Git快照是在原有文件版本的基础上重新生成一份新的文件，类似于备份。为了效率，如果文件没有修改，Git不再重新存储该文件，而是只保留一个链接指向之前存储的文件

- 缺点
  - 占用磁盘空间较大

- 优点
  - 版本切换时非常快，因为每个版本都是完整的文件快照，切换版本时直接恢复目标版本的快照即可

- 特点

  - 空间换时间

  - 能够本地执行

    - 在Git中绝大多数操作都只需要访问本地文件和资源，一般不需要来自网络上其它计算机的信息

    - 本地执行的表现

    1. 断网后依旧可以在本地对项目进行版本管理

    2. 联网后，把本地修改的记录同步到云端服务器即可

#### Git的三个区

使用Git管理的项目，拥有三个区域，分别是工作区、暂存区和Git仓库

- 工作区
  - 处理工作的区域

- 暂存区
  - 已完成的工作的临时存放区域，等待被提交

- Git仓库
  - 最终存放的区域

#### Git的三种状态

git的三种状态为：已修改（modified）、已暂存（staged）、已提交（committed）

- 已修改
  - 表示修改了文件，但还没将修改的结果放到暂存区

- 已暂存
  - 表示对已修改文件的当前版本做了标记，使之包含在下次提交的列表中

- 已提交
  - 表示文件已经安全地保存在本地的Git仓库中

> 注意点
>
> 如果工作区的文件被修改了，但还没有放到暂存区，就是已修改状态
>
> 如果文件已修改并放入暂存区，就属于已暂存状态
>
> 如果Git仓库中保存着特定版本的文件，就属于已提交状态

#### 工作区中文件的4种状态

工作区中的每一个文件可能有4种状态，这四种状态共分为两大类：

|       文件状态       |                             说明                             |    类别     |               Git符号               |
| :------------------: | :----------------------------------------------------------: | :---------: | :---------------------------------: |
| 未跟踪（untracked）  |                     不被Git所管理的文件                      | 未被Git管理 |                 ??                  |
| 未修改（unmodified） |       工作区中文件的内容和Git仓库中文件的内容保持一致        | 已被Git管理 |               无报告                |
|  已修改（Modified）  |        工作区中文件的内容和Git仓库中文件的内容不一致         | 已被Git管理 |                红色M                |
|   已暂存（Staged）   | 工作区中被修改的文件已被放到暂存区，准备将修改后的文件保存到Git仓库中 | 已被Git管理 | 绿色A或绿色M， A为新添加，M为新修改 |



 														

​						

​			  

​		工作区中文件的内容和Git仓库		已被Git管理  红色M

中文件的内容不一致

​		工作区中被修改的文件已被放到	已被Git管理  绿色A或绿色M

暂存区，准备将修改后的文件保				  A为新添加

存到Git仓库中		    				  M为新修改

在项目中新建的文件一般处于未跟踪状态，git不会自动将文件改为跟踪状态

Git操作的终极结果：让工作区中的文件都处于未修改状态

#### 初始化仓库

如果自己有一个尚未进行版本控制的项目目录，可以使用`git init`命令对当前目录进行仓库初始化

该命令会创建一个名为.git的隐藏目录，这个.git目录就是当前项目的Git仓库，里面包含了初始的必要文件，这些文件是Git仓库的必要组成部分，不能删除

#### 撤销对文件的修改

撤销对文件的修改指的是把对工作区中对应文件的修改，还原成Git仓库中所保存的版本

使用`git checkout --文件名`命令可以对一个文件进行撤销修改操作

操作的结果为所有的修改都会丢失，且无法恢复！危险性较高，慎重操作

#### Git的基本工作流程

1. 在工作区中修改文件

2. 将你想要下次提交的更改进行暂存

3. 提交更新，找到存储区的文件，将快照永久性存储到Git仓库

### 开源

#### 什么是开源？

1. 开源即开放源代码（Open source code）

2. 基本含义：代码是公开的

3. 特点：任何人都可以去查看、修改和使用开源代码

#### 什么是闭源？

1. 闭源即软件的代码是封闭的

2. 只有作者能看到闭源软件的代码

3. 只有作者能对源代码进行修改

#### 开源许可协议

开源并不意味着完全没有限制，为了限制使用者的使用范围和保护作者的权利，每个开源项目都应该遵守开源许可协议（Open Source License）

#### 常见的5种开源许可协议

1. `BSD（Berkeley Software Distribution）`

2. `Apache Licence 2.0`

3. `GPL（GNU General Public License）`

> GPL是具有传染性的一种开源协议，不允许修改后和衍生的代码作为闭源的商业软件发布和销售，即修改后的代码也必须开源
>
> 使用GPL最著名的软件项目是Linux

4. `LGPL（GNU Lesser General Public License）`

5. `MIT（Massachusetts Institute of Technology，MIT）`

> MIT是目前限制最少的协议，唯一的限制条件是在修改后的代码或者发行包中必须包含原作者的许可信息
>
> 使用MIT的软件项目：jQuery、Node.js

#### 开源的好处

开源的核心思想是“我为人人，人人为我”，人们越来越喜欢开源大致出于以下3个原因：

1. 开源给使用者更多的控制权

2. 开源让学习变得容易

3. 开源才有真正的安全（更多人参与可以使软件中错误更少）

#### 开源项目托管平台

开源项目托管平台指专门用于免费存放开源项目源代码的网站

目前世界上比较出名的开源项目托管平台主要有以下3个：

Github（全球最大的开源项目托管平台）

Gitlab（对代码私有性支持较好，企业用户较多）

Gitee（又叫做码云，是国产的开源项目托管平台。访问速度快，纯中文界面、使用友好）

> 注意：以上3个开源项目托管平台，只能托管以Git管理的项目源代码，因此，它们的名字都以Git开头

### 分支

#### 分支在实际开发中的作用

在进行多人协作开发的时候，为了防止互相干扰，提高协同开发的体验，建议每个开发者都基于分支进行项目功能的开发

#### master主分支

在初始化本地Git仓库的时候，Git默认已经帮我们创建了一个名字叫做master的分支，我们把这个master分支叫做主分支

在实际工作中，master主分支的作用是用来保存和记录整个项目已完成的功能代码

因此，不允许程序员直接在master分支上修改代码，因为这样做的风险太高，容易导致整个项目崩溃

#### 功能分支

由于程序员不能直接在master分支上进行功能的开发，所以就有了功能分支的概念

功能分支指的是专门用来开发新功能的分支，它是临时从master主分支上分叉出来的，当新功能开发且测试完毕后，最终需要合并到master主分支上。之后该功能分支需要被销毁

#### 遇到冲突时的分支合并

如果在两个不同的分支中，对同一个文件进行了不同的修改，Git就无法直接合并它们。

此时，我们需要打开这些包含冲突的文件手动解决冲突

- 步骤

1. 打开包含冲突的文件，手动解决冲突之后
2. 执行如下的命令

```
git add .			# 注意，.符号是必须的
git commit -m+”注释内容”
```



## 配置git

### 配置用户信息

```
git config --global user.name "用户名"

git config --global user.email "邮箱地址"
```

> 注意：如果使用了--global选项，那么该命令只需要运行一次，即可永久生效

### 检查配置信息

可以使用以下命令快速查看Git全局配置信息

```
git config --list --global	// 查看所有的全局配置信息

// 查看指定的全局配置项
git config user.name
git config user.email
```

### Git的全局配置文件

Git的全局配置文件问.gitconfig，位于C:/Users/ASUS/目录下，配置一次即可永久生效

### 获取帮助信息

可以使用`git help <verb>`命令，无需联网即可在浏览器中打开帮助手册

例如`git help config`或者`git config -h`

### .gitignore配置文件

如果我们希望让某些无需纳入Git管理的文件不出现在Git的未跟踪文件列表。我们可以创建一个名为.gitignore的配置文件，在该文件中列出要忽略的文件的匹配模式

> 注意.gitignore只能忽略那些原来没有被track的文件，如果某些文件已经被纳入了版本管理中，则修改.gitignore是无效的。因此该文件最好在项目创建之初就创建好

- .gitignore文件的格式规范如下

1. 以#开头的是注释

2. 以/结尾的是目录，该目录表示忽略该目录下所有的文件

3. 以/开头防止递归

4. 以!开头表示取反

5. 可以使用glob模式进行文件和文件夹的匹配

> glob模式是指简化后的正则表达式：
>
> 1. 星号*匹配零个或多个任意字符
>
> 2. [abc]匹配任何一个列在方括号中的字符
>
> 3. 问号?只匹配一个任意字符
>
> 4. 在方括号中使用短划线分隔两个字符，表示所有在这两个字符范围内的都可以匹配，如[0-9]表示匹配所有0到9的数字
>
> 5. 两个星号**表示匹配任意中间目录
>
> 例如：a/**/z可以匹配a/z、a/b/z、a/b/c/z等

### 远程仓库

#### 远程仓库的两种访问方式

在github上的远程仓库，有两种访问方式，分别是HTTPS和SSH

- HTTPS

HTTPS不需要进行任何配置即可使用，但是每次访问仓库时，需要重复输入Github的账号和密码才能访问

- SSH

SSH需要进行额外的配置，但是配置成功后，每次访问仓库时，不需要重复输入Github的账号和密码

> 注意：在实际开发中，推荐使用SSH的方式访问远程仓库

#### HTTPS上传仓库

在本地已经创建好git仓库后，可以使用以下代码将git仓库上传到远程仓库：

```
// 连接远程仓库
git remote add origin https://远程仓库地址

// 指定提交的分支，第一次提交必须运行需要运行这段代码，之后可以直接使用git push命令更新远程仓库
git push -u origin 分支名
```

#### SSH key

##### SSH key基本概念

- SSH key的作用

实现本地仓库和github之间免登录的加密数据传输

- SSH key的好处

免登录身份认证、数据加密传输

- SSH key的组成

SSH key由两部分组成，分别是：

1. `id_rsa`（私钥文件，存放于客户端的电脑中即可）

2. `id_rsa.pub`（公钥文件，需要配置到Github中）

##### 生成SSH key

1. 打开Git Bash

2. 粘贴如下命令

```
ssh-keygen -t rsa -b 4096 -C “注册Github账号时填写的邮箱”
```

3. 连续敲击3次回车，即可在C:\Users\用户名文件夹\.ssh目录中生成`id_rsa`和`id_rsa.pub`这两个文件

> 注意：如果失败可以在输入命令后到Git安装目录中的/user/bin/中找到ssh-keygen打开

##### 配置SSH key

1. 使用记事本打开id_rsa.pub文件，复制里面的文本内容

2. 登录github，点击`头像->setting->SSH and GPG keys->New SSH key`

3. 将`id_rsa.pub`文件中的内容，粘贴到key对应的文本框中

4. 在title文本框中任意填写一个名称，来标识这个key从何而来

##### 检测SSH key是否配置成功

输入`ssh -T git@github.com`，然后再输入`yes`即可

##### 基于SSH将本地仓库上传到github

- 步骤

1. 在本地创建仓库
2. 在github上创建仓库
3. 复制github上SSH的代码至git bash上即可

##### 将远程仓库克隆到本地

打开Git bash，输入以下命令即可

```
git clone+远程仓库地址
```

> 远程仓库地址可以在github上仓库的`clone or download`按钮进行查看

## git指令

> 注意：此处的指令不包含git的配置指令，配置指令见上

|                          指令                          |                             说明                             |
| :----------------------------------------------------: | :----------------------------------------------------------: |
|                        基础操作                        |                                                              |
|                       `git init`                       |                   将当前目录转化为git仓库                    |
|                    `git status -s`                     |       查看文件当前状态，-s表示以精简的方式输出状态报告       |
|                        添加文件                        |                                                              |
|                    `git add 文件名`                    | 让git开始跟踪目标文件或将目标文件放入暂存区或将有冲突文件标记为已解决 |
|                  `git add *.文件后缀`                  |               提交当前目录下所有符合规则的文件               |
|                        提交文件                        |                                                              |
|                 `git commit -m "注释"`                 |               将暂存区的内容提交至本地git仓库                |
|                `git commit -a -m"注释"`                |                 直接将工作区的内容提交到仓库                 |
|                        移除文件                        |                                                              |
|                 `git checkou --文件名`                 | 对目标文件进行撤销修改操作，即将工作区中目标文件的修改还原成git仓库中所保存的版本 |
|                `git reset HEAD 文件名`                 |                   将目标文件从暂存区中移出                   |
|                   `git rm -f 文件名`                   |              将目标文件同时从仓库和工作区中移出              |
|                `git rm --cached 文件名`                |         将目标文件从仓库中移除，但保留工作区中的文件         |
|                      查看提交历史                      |                                                              |
|                       `git log`                        | 按时间先后顺序列出所有的提交历史，最近的提交排在最上面，按q退出该界面 |
|             `git log -2 --pretty=oneline`              |              在一行上展示最近两条提交历史的信息              |
|      `git log -2 --pretty=format:”%h |%an|%ar|%s`      | 在一行上展示最近两条提交历史的信息，并自定义输出格式，后方参数为可选值<br/>%h表示提交的简写哈希值<br/>%an表示作者名字<br/>%ar表示作者修订日期，按多久以前的方式显示<br/>\|号为自定义的分隔符 |
|                        版本回退                        |                                                              |
|              `git reset --hard CommitID`               | 回退到指定的版本，CommitID是指定的提交ID，可以通过git log命令查看 |
|                        分支指令                        |                                                              |
|                      `git branch`                      |               查看当前git仓库中所有的分支列表                |
|                 `git branch 分支名称`                  | 基于当前分支创建一个新分支，此时新分支中的代码与当前分支完全一样 |
|               `git checkout -b 分支名称`               |          创建指定名称的新分支，并立即切换到新分支上          |
|           `git branch -M 旧分支名 新分支名`            |                  强制将旧分支名改为新分支名                  |
|                `git checkout 分支名称`                 |                        切换到目标分支                        |
|                `git merge+功能分支名称`                |            在当前分支上合并当前分支的所有功能分支            |
|              `git branch -d+功能分支名称`              |            删除目标分支，注意不能删除当前所在分支            |
|                        远程仓库                        |                                                              |
|                        上传仓库                        |                                                              |
|      `git remote add origin https://远程仓库地址`      |                    使用https上传本地仓库                     |
|     `git push -u 远程仓库名 本地分支名:远程分支名`     | 将本地分支提交到git服务上的对应分支，远程仓库名一般为origin，远程分支名忽略则默认与本地分支同名 |
|                       `git push`                       | 上方命令使用过一次后才可以使用此命令。<br/>此命令与上方命令作用相同 |
|                        克隆仓库                        |                                                              |
|                `git clone 远程仓库地址`                |                   将某个远程仓库克隆到本地                   |
|                      远程仓库分支                      |                                                              |
|             `git remote show+远程仓库名称`             |                 查看远程仓库中所有的分支列表                 |
|              `git checkout+远程分支名称`               |                       跟踪目标远程分支                       |
| `git checkout -b 本地分支名称 远程仓库名/远程分支名称` |         下载远程分支，并将下载好的本地分支进行重命名         |
|                       `git pull`                       |                    拉取当前分支的最新代码                    |
|     `git push 远程仓库名称 --delete 远程分支名称`      |                   删除远程仓库中指定的分支                   |

